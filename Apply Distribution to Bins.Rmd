---
title: "Apply Distribution to Bins"
author: "Thomas Castro"
date: "11/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(hrbrthemes)

```

```{r}

distribution_name <- "distribution_4"
distribution_scale <- "1000"

distr <- read_csv(paste0("distributions/",
                         distribution_name,
                         "-",
                         distribution_scale,
                         ".csv"))

# list of bins
scale_x_step <- c("group 1",
                  "group B",
                  "group 3",
                  "group 4",
                  "group 5",
                  "group 6",
                  "group 7",
                  "group 8")

```

```{r}

bin <- rep(1:length(scale_x_step), 
           each = ceiling(dim(distr)[1]/length(scale_x_step)))

bin <- bin[1:dim(distr)[1]]

distr <- cbind(distr,
               bin)

distribution <- distr %>% 
  group_by(bin) %>% 
  summarise(yVal = round(mean(yVal))) %>% 
  mutate(xVal = scale_x_step[bin]) %>% 
  select(xVal, yVal)

```

```{r}

# prepare vector with representative samples

d     <- vector()
d_val <- distribution$xVal
d_rep <- distribution$yVal

for (i in 1:length(d_rep)){
  d <- append(d, rep( d_val[i] , d_rep[i]) )
}

d_graph <- tibble(var = d) 

d_graph %>% 
  group_by(var) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(x = var,
             y = n)) +
  geom_point()

```


```{r}

# apply to a new column

vets <- read_csv("csv_files/veterans_table1.csv")
income <- sample(d, dim(vets)[1], replace = TRUE)

vets <- cbind(vets, income)

```

```{r, fig.width=10, fig.height=4}

vets %>% 
  group_by(income) %>% 
  summarise(n = n()) %>% 
  ggplot( aes(x = income,
              y = n)) +
  geom_point(size = 0.3) +
  theme_ipsum_ps() +
  labs(title = "Using distribution with different scaling",
       subtitle = "Scaled from pre-made distribution",
       x = "Annual Income",
       y = "count of peole",
       caption = "This is just test data for code development only")


```

